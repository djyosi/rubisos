<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üÜò rubiSOS - Real-Time Test</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: rgba(0,0,0,0.3);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .logo { font-size: 1.3rem; font-weight: 700; }
        .connection-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
        }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background: #22c55e; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        .container { flex: 1; padding: 20px; max-width: 500px; margin: 0 auto; width: 100%; }
        .screen { display: none; }
        .screen.active { display: block; }
        
        /* User Selection */
        .user-selection { text-align: center; padding: 40px 20px; }
        .user-selection h2 { margin-bottom: 10px; font-size: 1.8rem; }
        .user-selection p { color: #94a3b8; margin-bottom: 30px; }
        
        .user-cards { display: grid; gap: 20px; }
        .user-card {
            background: rgba(255,255,255,0.05);
            border: 2px solid transparent;
            border-radius: 16px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }
        .user-card:hover { border-color: #3b82f6; background: rgba(59,130,246,0.1); }
        .user-card.selected { border-color: #22c55e; background: rgba(34,197,94,0.1); }
        
        .user-avatar {
            width: 60px; height: 60px; border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            display: flex; align-items: center; justify-content: center;
            font-size: 2rem; margin-bottom: 15px;
        }
        .user-card.tami .user-avatar { background: linear-gradient(135deg, #ec4899, #f472b6); }
        .user-card.yosi .user-avatar { background: linear-gradient(135deg, #3b82f6, #06b6d4); }
        .user-name { font-size: 1.3rem; font-weight: 600; margin-bottom: 5px; }
        .user-location { color: #94a3b8; font-size: 0.9rem; }
        
        /* Main App Screen */
        .app-header {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .app-avatar { width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
        .app-info { flex: 1; }
        .app-name { font-weight: 600; }
        .app-status { font-size: 0.8rem; color: #94a3b8; }
        .switch-btn {
            background: rgba(255,255,255,0.1); border: none;
            padding: 8px 15px; border-radius: 8px; color: #fff;
            font-size: 0.8rem; cursor: pointer;
        }
        
        /* Waiting Screen */
        .waiting-screen {
            text-align: center;
            padding: 60px 20px;
        }
        .radar {
            width: 150px; height: 150px;
            border-radius: 50%;
            border: 2px solid rgba(34,197,94,0.3);
            margin: 0 auto 30px;
            position: relative;
            display: flex; align-items: center; justify-content: center;
        }
        .radar::before {
            content: ''; position: absolute;
            width: 100%; height: 100%;
            border-radius: 50%;
            border: 2px solid rgba(34,197,94,0.1);
            animation: radar 2s infinite;
        }
        @keyframes radar {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        .radar-icon { font-size: 3rem; }
        .waiting-text { color: #22c55e; font-size: 1.2rem; margin-bottom: 10px; }
        .waiting-sub { color: #94a3b8; font-size: 0.9rem; }
        
        /* SOS Button */
        .sos-container { display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .sos-button {
            width: 180px; height: 180px; border-radius: 50%;
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            border: none; color: white; font-size: 1.8rem; font-weight: 800;
            cursor: pointer; box-shadow: 0 10px 40px rgba(220, 38, 38, 0.5);
            transition: all 0.3s;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .sos-button:active { transform: scale(0.95); }
        .sos-button.counting { animation: pulse-red 1s infinite; }
        @keyframes pulse-red { 0%, 100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); } 50% { box-shadow: 0 0 0 30px rgba(220, 38, 38, 0); } }
        .sos-label { font-size: 0.8rem; opacity: 0.9; margin-top: 5px; }
        
        /* FULL SCREEN INCOMING ALERT */
        .incoming-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            z-index: 1000;
            display: none;
            flex-direction: column;
            padding: 30px 20px;
            animation: slide-in 0.5s ease;
        }
        .incoming-overlay.active { display: flex; }
        @keyframes slide-in {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        
        .alert-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .alert-icon-big { font-size: 5rem; margin-bottom: 10px; animation: shake 0.5s infinite; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .alert-title-big { font-size: 2rem; font-weight: 800; }
        .alert-subtitle-big { font-size: 1.1rem; opacity: 0.9; margin-top: 5px; }
        
        .sender-card {
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
        }
        .sender-profile {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        .sender-avatar-big {
            width: 80px; height: 80px;
            border-radius: 50%;
            font-size: 2.5rem;
            display: flex; align-items: center; justify-content: center;
            background: linear-gradient(135deg, #3b82f6, #06b6d4);
        }
        .sender-info-big { flex: 1; }
        .sender-name-big { font-size: 1.5rem; font-weight: 700; }
        .sender-detail { font-size: 0.9rem; opacity: 0.8; margin-top: 5px; }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .info-row:last-child { border-bottom: none; }
        .info-label { opacity: 0.7; }
        .info-value { font-weight: 600; }
        .info-value.blood { background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 20px; }
        .info-value.distance { color: #fbbf24; font-size: 1.2rem; }
        
        .response-buttons-big {
            margin-top: auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .btn-big {
            padding: 25px 20px;
            border: none;
            border-radius: 16px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
        }
        .btn-big:hover { transform: translateY(-2px); }
        .btn-coming { background: #22c55e; color: white; }
        .btn-reject { background: rgba(255,255,255,0.2); color: white; }
        
        .emergency-badge-big {
            background: rgba(0,0,0,0.4);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }
        
        /* Response Received Screen */
        .response-screen { text-align: center; padding: 40px 20px; }
        .response-icon { font-size: 5rem; margin-bottom: 20px; }
        .response-title { font-size: 1.5rem; font-weight: 600; margin-bottom: 10px; }
        .response-text { color: #94a3b8; margin-bottom: 30px; }
        
        .responder-card {
            background: rgba(34,197,94,0.1);
            border: 2px solid #22c55e;
            border-radius: 16px;
            padding: 25px;
            margin: 20px 0;
        }
        .responder-status { color: #22c55e; font-size: 1.2rem; font-weight: 600; }
        .responder-eta { font-size: 2.5rem; font-weight: 700; margin: 10px 0; color: #22c55e; }
        
        .cancel-btn {
            margin-top: 20px;
            padding: 15px 30px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 12px; color: white;
            font-size: 1rem; cursor: pointer; width: 100%;
        }
        
        .emergency-types { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 20px 0; }
        .emergency-type { padding: 15px; background: rgba(255,255,255,0.05); border: 2px solid transparent; border-radius: 12px; text-align: center; cursor: pointer; }
        .emergency-type.selected { border-color: #dc2626; background: rgba(220, 38, 38, 0.2); }
        .emergency-icon { font-size: 1.5rem; margin-bottom: 5px; }
        
        h2 { margin-bottom: 10px; }
        .subtitle { color: #94a3b8; margin-bottom: 20px; font-size: 0.9rem; }
        
        /* Demo Controls */
        .demo-controls {
            position: fixed;
            bottom: 100px;
            left: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            border-radius: 12px;
            padding: 15px;
            z-index: 500;
        }
        .demo-controls h4 { margin-bottom: 10px; color: #fbbf24; }
        .demo-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            margin: 5px;
            cursor: pointer;
            font-size: 0.85rem;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">üÜò rubiSOS</div>
        <div class="connection-status">
            <div class="status-dot"></div>
            <span>Connected</span>
        </div>
    </div>

    <div class="container">
        
        <!-- USER SELECTION -->
        <div class="screen active" id="screen-select">
            <div class="user-selection">
                <h2>Who are you?</h2>
                <p>Select your profile to start testing</p>
                
                <div class="user-cards">
                    <div class="user-card tami" onclick="selectUser('tami')">
                        <div class="user-avatar">üë©</div>
                        <div class="user-name">Tami</div>
                        <div class="user-location">üìç NW11 7NA, London</div>
                    </div>
                    
                    <div class="user-card yosi" onclick="selectUser('yosi')">
                        <div class="user-avatar">üë®</div>
                        <div class="user-name">Yosi</div>
                        <div class="user-location">üìç N3 3DP, London</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- YOSI'S VIEW (Sender) -->
        <div class="screen" id="screen-yosi">
            <div class="app-header">
                <div class="app-avatar" style="background: linear-gradient(135deg, #3b82f6, #06b6d4);">üë®</div>
                <div class="app-info">
                    <div class="app-name">Yosi</div>
                    <div class="app-status">Ready to send SOS</div>
                </div>
                <button class="switch-btn" onclick="switchUser()">Switch</button>
            </div>
            
            <div class="emergency-types">
                <div class="emergency-type selected" onclick="selectType(this, 'medical')">
                    <div class="emergency-icon">üöë</div>
                    <div class="emergency-label">Medical</div>
                </div>
                <div class="emergency-type" onclick="selectType(this, 'crime')">
                    <div class="emergency-icon">ü¶π</div>
                    <div class="emergency-label">Crime</div>
                </div>
                <div class="emergency-type" onclick="selectType(this, 'fire')">
                    <div class="emergency-icon">üî•</div>
                    <div class="emergency-label">Fire</div>
                </div>
                <div class="emergency-type" onclick="selectType(this, 'other')">
                    <div class="emergency-icon">‚ö†Ô∏è</div>
                    <div class="emergency-label">Other</div>
                </div>
            </div>
            
            <div class="sos-container">
                <button class="sos-button" id="sosBtn">
                    <span>SOS</span>
                    <span class="sos-label">HOLD 3 SEC</span>
                </button>
                
                <p class="subtitle" style="text-align: center; margin-top: 20px;">
                    Press and hold to send alert<br>
                    Tami will receive it instantly
                </p>
            </div>
            
            <!-- Demo controls for testing -->
            <div class="demo-controls">
                <h4>üß™ Demo Controls (for testing):</h4>
                <button class="demo-btn" onclick="simulateTamiReceives()">Simulate Tami Receives Alert</button>
                <button class="demo-btn" onclick="simulateTamiResponds()">Simulate Tami Responds</button>
                <p style="font-size: 0.8rem; color: #94a3b8; margin-top: 10px;"
003e
                    üí° For 2-device test: Open this URL on another device,<br>select "Tami", then tap "Simulate Receive" when Yosi sends SOS
                </p>
            </div>
        </div>

        <!-- WAITING FOR RESPONSE (Yosi's view) -->
        <div class="screen" id="screen-waiting">
            <div class="response-screen">
                <div class="response-icon">üì°</div>
                <div class="response-title">Alert Sent!</div>
                <div class="response-text">
                    Broadcasting to nearby helpers...
                </div>
                
                <div id="waitingForResponse">
                    <p style="color: #94a3b8;">‚è≥ Waiting for Tami to respond...</p>
                </div>
                
                <div id="responseReceived" style="display: none;">
                    <div class="responder-card">
                        <div class="responder-status">‚úÖ Tami is COMING!</div>
                        <div class="responder-eta">8 min</div>
                        <p style="color: #94a3b8; font-size: 0.9rem;">She can see your exact location</p>
                    </div>
                </div>
                
                <button class="cancel-btn" onclick="cancelSOS()">‚úï Cancel Emergency</button>
            </div>
        </div>

        <!-- TAMI'S VIEW (Receiver - Waiting) -->
        <div class="screen" id="screen-tami-waiting">
            <div class="app-header">
                <div class="app-avatar" style="background: linear-gradient(135deg, #ec4899, #f472b6);">üë©</div>
                <div class="app-info">
                    <div class="app-name">Tami</div>
                    <div class="app-status">Monitoring for alerts</div>
                </div>
                <button class="switch-btn" onclick="switchUser()">Switch</button>
            </div>
            
            <div class="waiting-screen">
                <div class="radar">
                    <div class="radar-icon">üì°</div>
                </div>
                
                <div class="waiting-text">‚úÖ Ready for Alerts</div>
                
                <div class="waiting-sub">
                    You'll be notified immediately<br>if Yosi sends an SOS alert<br><br>
                    Distance: 2.1 km away
                </div>
                
                <!-- Demo control for Tami -->
                <div style="margin-top: 40px; padding: 20px; background: rgba(0,0,0,0.3); border-radius: 12px;">
                    <p style="color: #fbbf24; font-size: 0.9rem; margin-bottom: 10px;">üß™ Demo: Simulate receiving alert</p>
                    <button class="demo-btn" onclick="simulateIncoming()">Show Incoming Alert</button>
                </div>
            </div>
        </div>

        <!-- RESPONSE SENT (Tami's view after responding) -->
        <div class="screen" id="screen-responded">
            <div class="response-screen">
                <div class="response-icon" id="responseIcon">‚úÖ</div>
                <div class="response-title" id="responseTitle">You're on the way!</div>
                <div class="response-text">
                    Yosi has been notified that you're coming.<br>
                    ETA: 8 minutes
                </div>
                
                <div style="background: rgba(255,255,255,0.05); border-radius: 16px; padding: 20px; margin: 20px 0;">
                    <strong>üìç Navigate to:</strong><br>
                    N3 3DP, London<br>
                    <span style="color: #94a3b8; font-size: 0.9rem;">Tap to open in Maps</span>
                </div>
                
                <button class="cancel-btn" onclick="backToWaiting()">Back to Monitoring</button>
            </div>
        </div>
    </div>

    <!-- FULL SCREEN INCOMING ALERT (for Tami) -->
    <div class="incoming-overlay" id="incomingOverlay">
        <div class="alert-header">
            <div class="alert-icon-big">üÜò</div>
            <div class="alert-title-big">EMERGENCY ALERT!</div>
            <div class="alert-subtitle-big">Someone nearby needs help</div>
        </div>
        
        <div class="emergency-badge-big" id="overlayEmergencyType">
            üöë MEDICAL EMERGENCY
        </div>
        
        <div class="sender-card">
            <div class="sender-profile">
                <div class="sender-avatar-big">üë®</div>
                <div class="sender-info-big">
                    <div class="sender-name-big">Yosi</div>
                    <div class="sender-detail">üì± +44 7700 900003</div>
                </div>
            </div>
            
            <div class="info-row">
                <span class="info-label">üìç Location</span>
                <span class="info-value">N3 3DP, London</span>
            </div>
            
            <div class="info-row">
                <span class="info-label">üìè Distance</span>
                <span class="info-value distance">2.1 km</span>
            </div>
            
            <div class="info-row">
                <span class="info-label">‚è±Ô∏è ETA</span>
                <span class="info-value">~8 minutes</span>
            </div>
            
            <div class="info-row">
                <span class="info-label">ü©∏ Blood Type</span>
                <span class="info-value blood">A+</span>
            </div>
            
            <div class="info-row">
                <span class="info-label">üö® Emergency Contact</span>
                <span class="info-value">Partner (+44 7700 900004)</span>
            </div>
        </div>
        
        
        <div class="response-buttons-big">
            <button class="btn-big btn-coming" onclick="respondToAlert('coming')">
                ‚úÖ I'm Coming
            </button>
            
            <button class="btn-big btn-reject" onclick="respondToAlert('unable')">
                ‚ùå Can't Help
            </button>
        </div>
    </div>

    <script>
        let currentUser = null;
        let emergencyType = 'medical';
        let sosTimer = null;
        
        const emergencyLabels = {
            medical: 'üöë MEDICAL EMERGENCY',
            crime: 'ü¶π CRIME IN PROGRESS',
            fire: 'üî• FIRE',
            other: '‚ö†Ô∏è EMERGENCY'
        };
        
        // Sound for alert
        function playAlertSound() {
            const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHP8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTGH0fPTgjMGHm7A7+OZSA0PVanu8LdnHQUuh9Dz2YU2Bhxpv+zplkcODVGm5O+4ZSAEMYrO89GFNwYdcfDr4ZdJDQtPp+XysWUeBjiS1/LNfi0GI33R8tOENAcdcO/r4phJDQxPp+TwxWUhBDeOzvPXhjYGHG3A7+SaSQ0MTKjl8bhkIAU2jc7z2YU1Bhxwv+zmmUgNC1Ko5O/EZSAFNo/M89CEMwYdcfDr4plHDAtQp+TvvWUfBTiOz/PShjUGG3Dw7OKZRwwLUqjl8b1kHwU3jM7z1YU1Bxtw8OzhmEcNC1Ko5fG+ZSAF');
            audio.play().catch(e => console.log('Audio play failed'));
        }
        
        // Vibrate
        function vibrate() {
            if (navigator.vibrate) {
                navigator.vibrate([500, 200, 500, 200, 1000, 200, 1000]);
            }
        }
        
        function selectUser(userId) {
            currentUser = userId;
            document.querySelectorAll('.user-card').forEach(c => c.classList.remove('selected'));
            document.querySelector('.' + userId).classList.add('selected');
            
            setTimeout(() => {
                document.getElementById('screen-select').classList.remove('active');
                
                if (userId === 'yosi') {
                    document.getElementById('screen-yosi').classList.add('active');
                } else {
                    document.getElementById('screen-tami-waiting').classList.add('active');
                }
            }, 300);
        }
        
        function switchUser() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('incomingOverlay').classList.remove('active');
            document.getElementById('screen-select').classList.add('active');
            document.querySelectorAll('.user-card').forEach(c => c.classList.remove('selected'));
            currentUser = null;
        }
        
        function selectType(el, type) {
            document.querySelectorAll('.emergency-type').forEach(t => t.classList.remove('selected'));
            el.classList.add('selected');
            emergencyType = type;
        }
        
        // SOS Button
        const sosBtn = document.getElementById('sosBtn');
        
        sosBtn.addEventListener('mousedown', startHold);
        sosBtn.addEventListener('touchstart', startHold);
        sosBtn.addEventListener('mouseup', endHold);
        sosBtn.addEventListener('touchend', endHold);
        sosBtn.addEventListener('mouseleave', endHold);
        
        function startHold(e) {
            e.preventDefault();
            sosBtn.classList.add('counting');
            sosBtn.innerHTML = '<span>3</span><span class="sos-label">HOLD...</span>';
            
            let count = 3;
            sosTimer = setInterval(() => {
                count--;
                if (count > 0) {
                    sosBtn.innerHTML = `<span>${count}</span><span class="sos-label">HOLD...</span>`;
                } else {
                    clearInterval(sosTimer);
                    sendSOS();
                }
            }, 1000);
        }
        
        function endHold() {
            clearInterval(sosTimer);
            sosBtn.classList.remove('counting');
            sosBtn.innerHTML = '<span>SOS</span><span class="sos-label">HOLD 3 SEC</span>';
        }
        
        function sendSOS() {
            vibrate();
            
            // Store alert in localStorage for cross-device sync
            const alert = {
                type: emergencyType,
                timestamp: Date.now(),
                from: 'yosi'
            };
            localStorage.setItem('rubisos_alert', JSON.stringify(alert));
            
            // Show waiting screen
            document.getElementById('screen-yosi').classList.remove('active');
            document.getElementById('screen-waiting').classList.add('active');
            
            alert('üö® SOS Alert Sent!\n\nIn a real app, Tami would receive a push notification.\n\nFor this demo:\n1. Open this URL on another device\n2. Select "Tami"\n3. Tap "Show Incoming Alert"\n\nOr press the "Simulate Tami Receives" button above.');
        }
        
        // Simulate Tami receiving (for demo)
        function simulateTamiReceives() {
            // This simulates what happens on Tami's device
            alert('üì± On Tami\'s device:\n\nShe would see:\nüÜò FULL SCREEN ALERT\n\nWith:\n‚Ä¢ Yosi\'s name & photo\n‚Ä¢ Blood type: A+\n‚Ä¢ Distance: 2.1 km\n‚Ä¢ ETA: 8 minutes\n‚Ä¢ Emergency type\n\nPlus buttons:\n‚úÖ I\'m Coming\n‚ùå Can\'t Help');
        }
        
        function simulateTamiResponds() {
            document.getElementById('waitingForResponse').style.display = 'none';
            document.getElementById('responseReceived').style.display = 'block';
        }
        
        // For Tami - simulate incoming
        function simulateIncoming() {
            document.getElementById('overlayEmergencyType').textContent = emergencyLabels[emergencyType];
            document.getElementById('incomingOverlay').classList.add('active');
            playAlertSound();
            vibrate();
        }
        
        // Response to alert
        function respondToAlert(response) {
            document.getElementById('incomingOverlay').classList.remove('active');
            
            if (response === 'coming') {
                document.getElementById('screen-tami-waiting').classList.remove('active');
                document.getElementById('screen-responded').classList.add('active');
                
                // Store response for Yosi to see
                localStorage.setItem('rubisos_response', JSON.stringify({
                    response: 'coming',
                    from: 'tami',
                    timestamp: Date.now()
                }));
            } else {
                backToWaiting();
            }
        }
        
        function backToWaiting() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('incomingOverlay').classList.remove('active');
            
            if (currentUser === 'tami') {
                document.getElementById('screen-tami-waiting').classList.add('active');
            } else {
                document.getElementById('screen-yosi').classList.add('active');
            }
        }
        
        function cancelSOS() {
            if (confirm('Cancel this emergency?')) {
                localStorage.removeItem('rubisos_alert');
                backToWaiting();
            }
        }
        
        // Check for alerts (polling for demo)
        setInterval(() => {
            if (currentUser === 'tami') {
                const alert = localStorage.getItem('rubisos_alert');
                if (alert) {
                    const data = JSON.parse(alert);
                    if (data.from === 'yosi' && !document.getElementById('incomingOverlay').classList.contains('active')) {
                        simulateIncoming();
                    }
                }
            }
            
            if (currentUser === 'yosi' && document.getElementById('screen-waiting').classList.contains('active')) {
                const response = localStorage.getItem('rubisos_response');
                if (response) {
                    const data = JSON.parse(response);
                    if (data.from === 'tami' && data.response === 'coming') {
                        document.getElementById('waitingForResponse').style.display = 'none';
                        document.getElementById('responseReceived').style.display = 'block';
                        localStorage.removeItem('rubisos_response');
                    }
                }
            }
        }, 1000);
        
        // Clear old alerts on load
        window.addEventListener('load', () => {
            localStorage.removeItem('rubisos_alert');
            localStorage.removeItem('rubisos_response');
        });
    </script>
</body>
</html>
